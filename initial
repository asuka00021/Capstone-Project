
R version 3.5.0 (2018-04-23) -- "Joy in Playing"
Copyright (C) 2018 The R Foundation for Statistical Computing
Platform: x86_64-w64-mingw32/x64 (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

[Workspace loaded from ~/.RData]

> wine = read.csv("C:/Users/wangch/Documents/CKME136/wine-reviews/winemag-data-130k-v2.csv", header =TRUE)
> library(ggplot2)
Warning message:
package ‘ggplot2’ was built under R version 3.5.1 
> # data cleansing - identify missing data




> summary(wine)
       X              country     
 Min.   :     0   US      :54504  
 1st Qu.: 32493   France  :22093  
 Median : 64985   Italy   :19540  
 Mean   : 64985   Spain   : 6645  
 3rd Qu.: 97478   Portugal: 5691  
 Max.   :129970   Chile   : 4472  
                  (Other) :17026  
                                                                                                                                                                                                                                                                                                        description    
 Cigar box, cafÃ© au lait, and dried tobacco aromas are followed by coffee and cherry flavors, with barrel spices lingering on the finish. The wood gets a bit out front but it still delivers enjoyment.                                                                                                     :     3  
 Gravenstein apple, honeysuckle and jasmine aromas show on the relatively boisterous nose of this bottling from a large vineyard on Highway 46 east of Paso Robles. There is compellingly grippy texture to the sip, with ripe flavors of pear and honeydew melon. A salty acidity takes it to the next level.:     3  
 Ripe plum, game, truffle, leather and menthol are some of the aromas you'll find on this earthy wine. The tightly wound palate offers dried black cherry, chopped sage, mint and roasted coffee bean alongside raspy tannins that leave a mouth-drying finish.                                               :     3  
 Seductively tart in lemon pith, cranberry and pomegranate, this refreshing, light-bodied quaff is infinitely enjoyable, both on its own or at the table. It continues to expand on the palate into an increasing array of fresh flavors, finishing in cherry and orange.                                     :     3  
 Stalky aromas suggest hay and green herbs, with raspberry in the backdrop. It's hot and short in terms of mouthfeel, with herbal flavors leading the way and berry fruit running behind. Dry red fruit and herbal notes dominate the finish.                                                                 :     3  
 This zesty red has pretty aromas that suggest small red berry, blue flower and a whiff of moist soil. The vibrant palate offers sour cherry, pomegranate and a hint of anise alongside zesty acidity and refined tannins.                                                                                    :     3  
 (Other)                                                                                                                                                                                                                                                                                                      :129953  
       designation        points           price               province    
             :37465   Min.   : 80.00   Min.   :   4.00   California:36247  
 Reserve     : 2009   1st Qu.: 86.00   1st Qu.:  17.00   Washington: 8639  
 Estate      : 1322   Median : 88.00   Median :  25.00   Bordeaux  : 5941  
 Reserva     : 1259   Mean   : 88.45   Mean   :  35.36   Tuscany   : 5897  
 Riserva     :  698   3rd Qu.: 91.00   3rd Qu.:  42.00   Oregon    : 5373  
 Estate Grown:  621   Max.   :100.00   Max.   :3300.00   Burgundy  : 3980  
 (Other)     :86597                    NA's   :8996      (Other)   :63894  
                 region_1                  region_2                taster_name   
                     :21247                    :79460                    :26244  
 Napa Valley         : 4480   Central Coast    :11065   Roger Voss       :25514  
 Columbia Valley (WA): 4124   Sonoma           : 9028   Michael Schachner:15134  
 Russian River Valley: 3091   Columbia Valley  : 8103   Kerin Oâ€™Keefe  :10776  
 California          : 2629   Napa             : 6814   Virginie Boone   : 9537  
 Paso Robles         : 2350   Willamette Valley: 3423   Paul Gregutt     : 9532  
 (Other)             :92050   (Other)          :12078   (Other)          :33234  
  taster_twitter_handle                                                     title       
             :31213     Gloria Ferrer NV Sonoma Brut Sparkling (Sonoma County) :    11  
 @vossroger  :25514     Korbel NV Brut Sparkling (California)                  :     9  
 @wineschach :15134     Segura Viudas NV Extra Dry Sparkling (Cava)            :     8  
 @kerinokeefe:10776     Gloria Ferrer NV Blanc de Noirs Sparkling (Carneros)   :     7  
 @vboone     : 9537     Ruinart NV Brut RosÃ©  (Champagne)                     :     7  
 @paulgwineÂ : 9532     Segura Viudas NV Aria Estate Extra Dry Sparkling (Cava):     7  
 (Other)     :28265     (Other)                                                :129922  
                     variety                     winery      
 Pinot Noir              :13272   Wines & Winemakers:   222  
 Chardonnay              :11753   Testarossa        :   218  
 Cabernet Sauvignon      : 9472   DFJ Vinhos        :   215  
 Red Blend               : 8946   Williams Selyem   :   211  
 Bordeaux-style Red Blend: 6915   Louis Latour      :   199  
 Riesling                : 5189   Georges Duboeuf   :   196  
 (Other)                 :74424   (Other)           :128710  



> print(colSums(is.na(wine)))
                   X1               country           description           designation                points 
                    0                    63                     0                 37465                     0 
                price              province              region_1              region_2           taster_name 
                 8996                    63                 21247                 79460                 26244 
taster_twitter_handle                 title               variety                winery 
                31213                     0                     1                     0 


> #replace missing price with median price
> wine$price[is.na(wine$price)]<-median(wine$price,na.rm=TRUE)

> summary(wine)
       X              country     
 Min.   :     0   US      :54504  
 1st Qu.: 32493   France  :22093  
 Median : 64985   Italy   :19540  
 Mean   : 64985   Spain   : 6645  
 3rd Qu.: 97478   Portugal: 5691  
 Max.   :129970   Chile   : 4472  
                  (Other) :17026  
                                                                                                                                                                                                                                                                                                        description    
 Cigar box, cafÃ© au lait, and dried tobacco aromas are followed by coffee and cherry flavors, with barrel spices lingering on the finish. The wood gets a bit out front but it still delivers enjoyment.                                                                                                     :     3  
 Gravenstein apple, honeysuckle and jasmine aromas show on the relatively boisterous nose of this bottling from a large vineyard on Highway 46 east of Paso Robles. There is compellingly grippy texture to the sip, with ripe flavors of pear and honeydew melon. A salty acidity takes it to the next level.:     3  
 Ripe plum, game, truffle, leather and menthol are some of the aromas you'll find on this earthy wine. The tightly wound palate offers dried black cherry, chopped sage, mint and roasted coffee bean alongside raspy tannins that leave a mouth-drying finish.                                               :     3  
 Seductively tart in lemon pith, cranberry and pomegranate, this refreshing, light-bodied quaff is infinitely enjoyable, both on its own or at the table. It continues to expand on the palate into an increasing array of fresh flavors, finishing in cherry and orange.                                     :     3  
 Stalky aromas suggest hay and green herbs, with raspberry in the backdrop. It's hot and short in terms of mouthfeel, with herbal flavors leading the way and berry fruit running behind. Dry red fruit and herbal notes dominate the finish.                                                                 :     3  
 This zesty red has pretty aromas that suggest small red berry, blue flower and a whiff of moist soil. The vibrant palate offers sour cherry, pomegranate and a hint of anise alongside zesty acidity and refined tannins.                                                                                    :     3  
 (Other)                                                                                                                                                                                                                                                                                                      :129953  
       designation        points           price               province    
             :37465   Min.   : 80.00   Min.   :   4.00   California:36247  
 Reserve     : 2009   1st Qu.: 86.00   1st Qu.:  18.00   Washington: 8639  
 Estate      : 1322   Median : 88.00   Median :  25.00   Bordeaux  : 5941  
 Reserva     : 1259   Mean   : 88.45   Mean   :  34.65   Tuscany   : 5897  
 Riserva     :  698   3rd Qu.: 91.00   3rd Qu.:  40.00   Oregon    : 5373  
 Estate Grown:  621   Max.   :100.00   Max.   :3300.00   Burgundy  : 3980  
 (Other)     :86597                                      (Other)   :63894  
                 region_1                  region_2                taster_name   
                     :21247                    :79460                    :26244  
 Napa Valley         : 4480   Central Coast    :11065   Roger Voss       :25514  
 Columbia Valley (WA): 4124   Sonoma           : 9028   Michael Schachner:15134  
 Russian River Valley: 3091   Columbia Valley  : 8103   Kerin Oâ€™Keefe  :10776  
 California          : 2629   Napa             : 6814   Virginie Boone   : 9537  
 Paso Robles         : 2350   Willamette Valley: 3423   Paul Gregutt     : 9532  
 (Other)             :92050   (Other)          :12078   (Other)          :33234  
  taster_twitter_handle                                                     title       
             :31213     Gloria Ferrer NV Sonoma Brut Sparkling (Sonoma County) :    11  
 @vossroger  :25514     Korbel NV Brut Sparkling (California)                  :     9  
 @wineschach :15134     Segura Viudas NV Extra Dry Sparkling (Cava)            :     8  
 @kerinokeefe:10776     Gloria Ferrer NV Blanc de Noirs Sparkling (Carneros)   :     7  
 @vboone     : 9537     Ruinart NV Brut RosÃ©  (Champagne)                     :     7  
 @paulgwineÂ : 9532     Segura Viudas NV Aria Estate Extra Dry Sparkling (Cava):     7  
 (Other)     :28265     (Other)                                                :129922  
                     variety                     winery      
 Pinot Noir              :13272   Wines & Winemakers:   222  
 Chardonnay              :11753   Testarossa        :   218  
 Cabernet Sauvignon      : 9472   DFJ Vinhos        :   215  
 Red Blend               : 8946   Williams Selyem   :   211  
 Bordeaux-style Red Blend: 6915   Louis Latour      :   199  
 Riesling                : 5189   Georges Duboeuf   :   196  
 (Other)                 :74424   (Other)           :128710  



> unique_vals<-lapply(wine, unique)
> sapply(unique_vals, length)
                   X1               country           description           designation                points 
               129971                    44                119955                 37980                    21 
                price              province              region_1              region_2           taster_name 
                  390                   426                  1230                    18                    20 
taster_twitter_handle                 title               variety                winery 
                   16                118840                   708                 16757 


> sapply(wine,class)
                    X               country           description           designation 
            "integer"              "factor"              "factor"              "factor" 
               points                 price              province              region_1 
            "integer"             "integer"              "factor"              "factor" 
             region_2           taster_name taster_twitter_handle                 title 
             "factor"              "factor"              "factor"              "factor" 
              variety                winery 
             "factor"              "factor" 

#INSPECT THE POINTS
> > library(ggplot2)
> ggplot(wine, aes(x = points))
> hist(wine$points)


> summary(wine$points)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  80.00   86.00   88.00   88.45   91.00  100.00 


> sum(wine$points == 100)
[1] 19
> sum(wine$points == 80)
[1] 397

#points are mostly normally distrinbuted (also sample size is large enough should be normally distributed)

> library(outliers)
Warning message:
package ‘outliers’ was built under R version 3.5.2 
> outlier(wine$price, opposite=TRUE)
[1] 4
> outlier(wine$price, opposite=FALSE)
[1] 3300
> # price 4 and 3300 are both outlier of the wine price

> summary(wine$price)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   4.00   18.00   25.00   34.65   40.00 3300.00 
> boxplot(wine$price)
> # the price point $3000 is the outlier that we need to figure out what to do with

> wine %>% filter(wine$price > 1000)
# A tibble: 14 x 14
       X1 country description designation points price province region_1 region_2 taster_name taster_twitter_~ title
    <dbl> <chr>   <chr>       <chr>        <dbl> <dbl> <chr>    <chr>    <chr>    <chr>       <chr>            <chr>
 1   1558 France  A massive ~ NA              98  1900 Bordeaux Margaux  NA       Roger Voss  @vossroger       Chât~
 2   1566 France  Such a gen~ NA              97  1100 Bordeaux Pessac-~ NA       Roger Voss  @vossroger       Chât~
 3   1571 France  Solid, ver~ NA              96  1200 Bordeaux Pessac-~ NA       Roger Voss  @vossroger       Chât~
 4   1575 France  The purest~ NA              96  1300 Bordeaux Pauillac NA       Roger Voss  @vossroger       Chât~
 5  15840 France  The wine i~ NA              96  2500 Bordeaux Pomerol  NA       Roger Voss  @vossroger       Chât~
 6  65352 France  This extra~ NA              97  2000 Bordeaux Pomerol  NA       Roger Voss  @vossroger       Chât~
 7  80290 France  This ripe ~ NA              88  3300 Bordeaux Médoc    NA       Roger Voss  @vossroger       Chât~
 8  89478 Austria Wet earth,~ Ried Loibe~     94  1100 Wachau   NA       NA       Anne Krebi~ @AnneInVino      Emme~
 9  98380 France  A superb w~ NA              96  2500 Burgundy La Roma~ NA       Roger Voss  @vossroger       Doma~
10 111753 France  Almost bla~ NA             100  1500 Bordeaux Pauillac NA       Roger Voss  @vossroger       Chât~
11 111755 France  This is th~ NA             100  1500 Bordeaux Saint-É~ NA       Roger Voss  @vossroger       Chât~
12 113564 France  A wonderfu~ NA              96  2000 Burgundy La Roma~ NA       Roger Voss  @vossroger       Doma~
13 113581 France  While it s~ NA              94  1125 Burgundy La Roma~ NA       Roger Voss  @vossroger       Doma~
14 120391 US      The nose o~ Roger Rose~     91  2013 Califor~ Arroyo ~ Central~ Matt Kettm~ @mattkettmann    Blai~
# ... with 2 more variables: variety <chr>, winery <chr>
> sum(wine$price > 1000, na.rm = TRUE)
[1] 14
> sum(wine$price > 500, na.rm = TRUE)
[1] 91


> ggplot(data = wine, aes(x= price, colour = I('black'), fill = I('#099DD9')))+
+     geom_histogram()+
+     labs(x = "Price", y= "Frequency", title = "Distribution of log(prices)") #slightly right skewed
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

> wine$logprice <- log(wine$price)
> ggplot(data = wine, aes(x= log(price), colour = I('black'), fill = I('#099DD9')))+
+     geom_histogram()+
+     labs(x = "log(Price)", y= "Frequency", title = "Distribution of log(prices)") #slightly right skewed

> hist(wine$price)
> hist(wine$points, main = "points histogram", xlab = "points")
> #points are mostly normally distrinbuted (also sample size is large enough should be normally distributed), also tranform to log price 

#inspect correlations between numerical variable
> cor(wine$price, wine$points)
[1] 0.3992309
> cor(wine$logprice, wine$points)
[1] 0.5896118

# inspect correlation between categorical variable with points and price
> > chisq.test(wine$country, wine$points, correct = FALSE)

	Pearson's Chi-squared test

data:  wine$country and wine$points
X-squared = 11699, df = 840, p-value < 2.2e-16
> chisq.test(wine$country, wine$price, correct = FALSE)

	Pearson's Chi-squared test

data:  wine$country and wine$price
X-squared = 51022, df = 16338, p-value < 2.2e-16

Warning message:
In chisq.test(wine$country, wine$price, correct = FALSE) :
  Chi-squared approximation may be incorrect
  > chisq.test(wine$winery, wine$points, correct = FALSE)

	Pearson's Chi-squared test

data:  wine$winery and wine$points
X-squared = 453230, df = 335120, p-value < 2.2e-16

Warning message:
In chisq.test(wine$winery, wine$points, correct = FALSE) :
  Chi-squared approximation may be incorrect
> chisq.test(wine$variety, wine$points, correct = FALSE)

	Pearson's Chi-squared test

data:  wine$variety and wine$points
X-squared = 31759, df = 14120, p-value < 2.2e-16

Warning message:
In chisq.test(wine$variety, wine$points, correct = FALSE) :
  Chi-squared approximation may be incorrect
> 




#install tidyr
> library(ggplot2)
> library(tidyr)
Warning message:
package ‘tidyr’ was built under R version 3.5.1 
> library(tm)
Loading required package: NLP

Attaching package: ‘NLP’

The following object is masked from ‘package:ggplot2’:

    annotate

Warning messages:
1: package ‘tm’ was built under R version 3.5.2 
2: package ‘NLP’ was built under R version 3.5.2 
> library(dplyr)

Attaching package: ‘dplyr’

The following objects are masked from ‘package:dbplyr’:

    ident, sql

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

Warning message:
package ‘dplyr’ was built under R version 3.5.1 
> library(ggjoy)
Error in library(ggjoy) : there is no package called ‘ggjoy’
> install.packages("ggjoy")
Installing package into ‘C:/Users/wangch/Documents/R/win-library/3.5’
(as ‘lib’ is unspecified)
also installing the dependency ‘ggridges’

trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.5/ggridges_0.5.1.zip'
Warning in install.packages :
  InternetOpenUrl failed: 'The server name or address could not be resolved'
Error in download.file(url, destfile, method, mode = "wb", ...) : 
  cannot open URL 'https://cran.rstudio.com/bin/windows/contrib/3.5/ggridges_0.5.1.zip'
Warning in install.packages :
  download of package ‘ggridges’ failed
trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.5/ggjoy_0.4.1.zip'
Warning in install.packages :
  InternetOpenUrl failed: 'The connection with the server was reset'
Error in download.file(url, destfile, method, mode = "wb", ...) : 
  cannot open URL 'https://cran.rstudio.com/bin/windows/contrib/3.5/ggjoy_0.4.1.zip'
Warning in install.packages :
  download of package ‘ggjoy’ failed
> library("gridExtra")
Error in library("gridExtra") : there is no package called ‘gridExtra’
> library(gridExtra)
Error in library(gridExtra) : there is no package called ‘gridExtra’
> install.packages("gridExtra")
Installing package into ‘C:/Users/wangch/Documents/R/win-library/3.5’
(as ‘lib’ is unspecified)
trying URL 'https://cran.rstudio.com/bin/windows/contrib/3.5/gridExtra_2.3.zip'
Content type 'application/zip' length 1108441 bytes (1.1 MB)
downloaded 1.1 MB

package ‘gridExtra’ successfully unpacked and MD5 sums checked

The downloaded binary packages are in
	C:\Users\wangch\AppData\Local\Temp\Rtmps7Mbic\downloaded_packages
> library(gridExtra)

Attaching package: ‘gridExtra’

The following object is masked from ‘package:dplyr’:

    combine

Warning message:
package ‘gridExtra’ was built under R version 3.5.2 
> library(readr)
Warning message:
package ‘readr’ was built under R version 3.5.1 
> library(lightgbm)
Error in library(lightgbm) : there is no package called ‘lightgbm’
> install.packages("lightgbm")
Installing package into ‘C:/Users/wangch/Documents/R/win-library/3.5’
(as ‘lib’ is unspecified)
Warning in install.packages :
  package ‘lightgbm’ is not available (for R version 3.5.0)
> library(text2vec)
text2vec is still in beta version - APIs can be changed.
For tutorials and examples visit http://text2vec.org.

For FAQ refer to
  1. https://stackoverflow.com/questions/tagged/text2vec?sort=newest
  2. https://github.com/dselivanov/text2vec/issues?utf8=%E2%9C%93&q=is%3Aissue%20label%3Aquestion
If you have questions please post them at StackOverflow and mark with 'text2vec' tag.

Attaching package: ‘text2vec’

The following object is masked _by_ ‘.GlobalEnv’:

    normalize

Warning message:
package ‘text2vec’ was built under R version 3.5.2 
> library(SnowballC)
Warning message:
package ‘SnowballC’ was built under R version 3.5.2 
> library(wordcloud2)
Warning message:
package ‘wordcloud2’ was built under R version 3.5.2 
> library(RColorBrewer)
> library(quanteda)
Package version: 1.4.1
Parallel computing: 2 of 4 threads used.
See https://quanteda.io for tutorials and examples.

Attaching package: ‘quanteda’

The following objects are masked from ‘package:tm’:

    as.DocumentTermMatrix, stopwords

The following object is masked from ‘package:utils’:

    View

Warning message:
package ‘quanteda’ was built under R version 3.5.2 
> library(tidyverse)
-- Attaching packages --------------------------------------- tidyverse 1.2.1 --
v tibble  1.4.2     v stringr 1.3.1
v purrr   0.2.5     v forcats 0.3.0
-- Conflicts ------------------------------------------ tidyverse_conflicts() --
x NLP::annotate()      masks ggplot2::annotate()
x gridExtra::combine() masks dplyr::combine()
x dplyr::filter()      masks stats::filter()
x dplyr::ident()       masks dbplyr::ident()
x dplyr::lag()         masks stats::lag()
x dplyr::sql()         masks dbplyr::sql()
Warning messages:
1: package ‘tidyverse’ was built under R version 3.5.1 
2: package ‘tibble’ was built under R version 3.5.1 
3: package ‘purrr’ was built under R version 3.5.1 
4: package ‘stringr’ was built under R version 3.5.1 
5: package ‘forcats’ was built under R version 3.5.1 
> library(stringr)
> library(lubridate)

Attaching package: ‘lubridate’

The following object is masked from ‘package:base’:

    date

Warning message:
package ‘lubridate’ was built under R version 3.5.1 
> library(kableExtra)
Warning message:
package ‘kableExtra’ was built under R version 3.5.2 
> library(sqldf)
Loading required package: gsubfn
Loading required package: proto
Loading required package: RSQLite
Warning messages:
1: package ‘sqldf’ was built under R version 3.5.2 
2: package ‘gsubfn’ was built under R version 3.5.2 
3: package ‘proto’ was built under R version 3.5.2 
4: package ‘RSQLite’ was built under R version 3.5.2 
> library(htmlTable)
Warning message:
package ‘htmlTable’ was built under R version 3.5.2 
> wine %>%
+ group_by(country)%>%
+ filter(n() > 500) %>%
+ mutate(count = n()) %>%
+ mutate(avg = mean(points)) %>%
+ ggplot(aes(x = reorder(country, count))) +
+ geom_bar(fill = 'red')+
+ coord_flip() +
+ theme_classic() +
+ labs(x = 'country', y = 'count', title = "Popular Wines by Country")

> wine %>%
+ group_by(winery) %>%
+ filter(n() >500) %>%
+ mutate(count = n()) %>%
+ mutate(avg = mean(points)) %>%
+ ggplot(aes(x = reorder(winery, count))) +
+ geom_bar(fill = 'blue') +
+ coord_flip() +
+ theme_classic() +
+ labs(x = 'winery', y = 'count', title ="Popular Wines by Winery")

> summary(wine$winery)
         Wines & Winemakers                  Testarossa                  DFJ Vinhos 
                        222                         218                         215 
            Williams Selyem                Louis Latour             Georges Duboeuf 
                        211                         199                         196 
      Chateau Ste. Michelle               Concha y Toro              Columbia Crest 
                        194                         164                         159 
            Kendall-Jackson                      Siduri                Gary Farrell 
                        130                         126                         125 
                     Lynmar               Albert Bichot                      Montes 
                        118                         117                         117 
           Casa Santos Lima  Jean-Luc and Paul Aegerter                    Trapiche 
                        113                         113                         113 
                  Undurraga              Robert Mondavi                   Santa Ema 
                        113                         112                         112 
      Chanson PÃ¨re et Fils                 Fess Parker                   V. Sattui 
                        109                         108                         107 
                 Iron Horse                       Foxen                 Louis Jadot 
                        106                         105                         104 
                   Chehalem       Feudi di San Gregorio                    Maryhill 
                        102                         102                         102 
               BrÃ¼ndlmayer      Domaine Zind-Humbrecht                       Kunde 
                        101                         101                         101 
                 D'Arenberg            Dutton-Goldfield                 Terre Rouge 
                        100                         100                         100 
                  Errazuriz              Cameron Hughes          Henri de Villamont 
                         99                          98                          98 
          J. Portugal Ramos                     Kenwood                  Martin Ray 
                         98                          98                          98 
                Seven Hills                  Dr. Loosen           Georges Vigouroux 
                         98                          96                          96 
              Rodney Strong                      Calera                    Fenestra 
                         96                          95                          95 
                    Naggiar            Olivier Leflaive                 Casca Wines 
                         95                          95                          94 
             Joseph Drouhin                     J. Lohr           Lamoreaux Landing 
                         94                          93                          93 
                 Santa Rita          Kirkland Signature       Companhia das Quintas 
                         93                          91                          90 
                  Rock Wall                    Balletto                  Waterbrook 
                         90                          89                          89 
               Novelty Hill                     Sineann                    De Loach 
                         88                          88                          87 
           FranÃ§ois Lurton                   San Pedro                    DÃ£o Sul 
                         87                          87                          86 
                   Recanati                   Adelsheim          Domaines Devillard 
                         86                          85                          85 
              Gloria Ferrer                  Kuentz-Bas                    MorandÃ© 
                         85                          85                          85 
                  Bernardus             La Chablisienne                   Milbrandt 
                         84                          84                          84 
Willamette Valley Vineyards                 Buena Vista         Herdade do EsporÃ£o 
                         84                          83                          83 
                 Heron Hill                Santa Alicia              Santa Carolina 
                         83                          83                          83 
      Bouchard PÃ¨re & Fils                      Cayuse                       Hogue 
                         81                          81                          81 
             L'Ecole No. 41                     Aveleda           Barton & Guestier 
                         81                          80                          80 
                Castle Rock                 Schramsberg        J Vineyards & Winery 
                         80                          80                          78 
             Marimar Estate                      Mercer                     Abacela 
                         77                          77                          76 
                     Januik              Pride Mountain          Dry Creek Vineyard 
                         76                          76                          75 
            Henri Bourgeois                      Morgan              Clos La Chance 
                         75                          75                          74 
                    (Other) 
                     119777 
> wine %>%
+ group_by(winery) %>%
+ filter(n() >120) %>%
+ mutate(count = n()) %>%
+ mutate(avg = mean(points)) %>%
+ ggplot(aes(x = reorder(winery, count))) +
+ geom_bar(fill = 'Red') +
+ coord_flip() +
+ theme_classic() +
+ labs(x = 'winery', y = 'count', title = "Popular Wine by Winery")
# final result shows that Wines and WIne Maker are the most popular ones

> wine %>%
+ group_by(province) %>%
+ filter(n() > 1000) %>%
+ mutate(count = n()) %>%
+ mutate(avg = mean(points)) %>%
+ ggplot(aes(x = reorder(province, count))) +
+ geom_bar(fill = 'Red') +
+ coord_flip() +
+ theme_classic() +
+ labs(x = 'province', y = 'count', title = 'Popular WIne Province Global')
# final result shows that California wine provide most popular wine , follow by Washington and Bordeau

> wine %>%
+ group_by(variety) %>%
+ filter(n() >1000) %>%
+ mutate(count = n()) %>%
+ mutate(avg = mean(points)) %>%
+ ggplot(aes(x = reorder(variety, count))) +
+ geom_bar(fill = 'Red') +
+ coord_flip() +
+ theme_classic() +
+ labs(x = 'variety', y = 'count', title = "Most Popular Varietal")
#Pinot Noir and Chardonnay is the most popular two 

> htmlTable(sqldf("select variety, country, price, points, winery from wine where price > 1200 order by price desc"))

variety	country	price	points	winery
1	Bordeaux-style Red Blend	France	3300	88	Château les Ormes Sorbet
2	Bordeaux-style Red Blend	France	2500	96	Château Pétrus
3	Pinot Noir	France	2500	96	Domaine du Comte Liger-Belair
4	Chardonnay	US	2013	91	Blair
5	Bordeaux-style Red Blend	France	2000	97	Château Pétrus
6	Pinot Noir	France	2000	96	Domaine du Comte Liger-Belair
7	Bordeaux-style Red Blend	France	1900	98	Château Margaux
8	Bordeaux-style Red Blend	France	1500	100	Château Lafite Rothschild
9	Bordeaux-style Red Blend	France	1500	100	Château Cheval Blanc
10	Bordeaux-style Red Blend	France	1300	96	Château Mouton Rothschild


> #TOP 30 VARIETY REVIEW
> TOP30 <- wine %>%
+ group_by(variety) %>%
+ summarise(count = n()) %>%
+ arrange(desc(count))
> top_30df <- TOP30[1:30,1:2]
> top_30df
# A tibble: 30 x 2
   variety                  count
   <chr>                    <int>
 1 Pinot Noir               13272
 2 Chardonnay               11753
 3 Cabernet Sauvignon        9472
 4 Red Blend                 8946
 5 Bordeaux-style Red Blend  6915
 6 Riesling                  5189
 7 Sauvignon Blanc           4967
 8 Syrah                     4142
 9 Rosé                      3564
10 Merlot                    3102
# ... with 20 more rows

> wine$wine_type <- ifelse(wine$variety == "Chardonnay" | wine$variety == "Riesling" | wine$variety == "Sauvignon Blanc" | wine$variety == "White Blend" | wine$variety == "Sparkling Blend" | wine$variety == "Pinot Gris" | wine$variety == "Champagne Blend" | wine$variety == "GrÃ¼ner Veltliner" | wine$variety == "Pinot Grigio" | wine$variety == "Portuguese White" | wine$variety == "Viognier" | wine$variety == "GewÃ¼rztraminer" | wine$variety == "GewÃ¼rztraminer", "White Wine", "Red Wine")
> wine %>%
+ group_by(wine_type) %>%
+ summarise(total = n()) %>%
+ arrange(desc(total)) %>%
+ mutate(topcount = round(total/sum(total), digits = 2), accum = cumsum(topcount))
# A tibble: 3 x 4
  wine_type  total topcount accum
  <chr>      <int>    <dbl> <dbl>
1 Red Wine   89999     0.75  0.75
2 White Wine 29955     0.25  1   
3 NA             1     0     1   
# top country
#the N/A of country is only 63 rows - so immaterial to teh total reviews and could be ignore, just remove any duplicate first


> winecountry <- wine %>%
+ group_by(country) %>%
+ summarise(total = n()) %>%
+ arrange(desc(total)) %>%
+ mutate(topcount = round(total/sum(total), digits = 5), accum = cumsum(topcount))
> winecountry
# A tibble: 44 x 4
   country   total topcount accum
   <chr>     <int>    <dbl> <dbl>
 1 US        50448   0.421  0.421
 2 France    20351   0.170  0.590
 3 Italy     17921   0.149  0.740
 4 Spain      6116   0.0510 0.791
 5 Portugal   5256   0.0438 0.834
 6 Chile      4184   0.0349 0.869
 7 Argentina  3543   0.0295 0.899
 8 Austria    3033   0.0253 0.924
 9 Australia  2197   0.0183 0.942
10 Germany    1992   0.0166 0.959
# ... with 34 more rows
#begin text analysis - first remove any duplicate (since we know there is no NA in description)
> library(dplyr)

Attaching package: ‘dplyr’

The following object is masked from ‘package:car’:

    recode

The following objects are masked from ‘package:lubridate’:

    intersect, setdiff, union

The following objects are masked from ‘package:stats’:

    filter, lag

The following objects are masked from ‘package:base’:

    intersect, setdiff, setequal, union

> wine<- wine %>%
+ mutate(duplicate = duplicated(description)) %>%
+ filter(duplicate==FALSE) %>%
+ select(-duplicate)

> # look at description length

> wine$wordcount <- sapply(gregexpr("\\S+", wine$description), length)
> summary(wine$wordcount)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   3.00   33.00   40.00   40.42   47.00  135.00 
> wine$description[which(wine$wordcount == 135)]
[1] "This very fine Cabernet wants a little time in the cellar. Right now, it's tight in tannins, with some acidic bitterness in the finish. The flavors are of black currants and smoky new oak. The Morisoli Vineyard has been home to very good, ageable bottlings from the likes of Sequoia Grove and Elyse, but in the last few years, Meander has expressed its terroir best. Try after 2012.This very fine Cabernet wants a little time in the cellar. Right now, it's tight in tannins, with some acidic bitterness in the finish. The flavors are of black currants and smoky new oak. The Morisoli Vineyard has been home to very good, ageable bottlings from the likes of Sequoia Grove and Elyse, but in the last few years, Meander has expressed its terroir best. Try after 2012."
> wine$description[which(wine$wordcount == 3)]
[1] "Imported by Kobrand."
> > ggplot(data = wine, aes(x = wordcount))+
+ geom_histogram(binwidth = 5) +
+ labs(x = 'wordcount', y = 'frequency', title = " # of wordcount in description")
#graph is slightly right skewed

> ggplot(data = wine, aes(x = wine_type, y = wordcount))+
+ geom_boxplot()+
+ coord_flip()+
+ labs(title = "wordcount distribution by winetype", x = "winetype",y ="word count")

#correlation between word count and points
> ggplot(data = wine, aes(x = wordcount, y = points))+
+ geom_point()
> cor(wine$wordcount, wine$points)
[1] 0.5218238

> #difference between word described for different wine types
> pinotnoir <- subset(wine,variety == "Pinot Noir")
> descriptors <- Corpus(VectorSource(pinotnoir$description))
> head(descriptors)
<<SimpleCorpus>>
Metadata:  corpus specific: 1, document level (indexed): 0
Content:  documents: 6
> descriptors<-tm_map(descriptors, content_transformer(tolower))
Warning message:
In tm_map.SimpleCorpus(descriptors, content_transformer(tolower)) :
  transformation drops documents
> descriptors<-tm_map(descriptors, removeNumbers)
Warning message:
In tm_map.SimpleCorpus(descriptors, removeNumbers) :
  transformation drops documents
> descriptors<-tm_map(descriptors, removeWords, c("wine", "pinot", "noir", "drink", "flavors", "and", "the","with"))
Warning message:
In tm_map.SimpleCorpus(descriptors, removeWords, c("wine", "pinot",  :
  transformation drops documents
> descriptors<-tm_map(descriptors, removePunctuation)
Warning message:
In tm_map.SimpleCorpus(descriptors, removePunctuation) :
  transformation drops documents
> descriptors<-tm_map(descriptors, stripWhitespace)
Warning message:
In tm_map.SimpleCorpus(descriptors, stripWhitespace) :
  transformation drops documents
> descriptors<-tm_map(descriptors, stemDocument)
Warning message:
In tm_map.SimpleCorpus(descriptors, stemDocument) :
  transformation drops documents
> dtmpinot<-TermDocumentMatrix(descriptors)
> dtm_mat<-as.matrix(dtm)
Error in as.matrix(dtm) : object 'dtm' not found
> dtm_mat<-as.matrix(dtmpinot)
> v <- sort(rowSums(dtm_mat), decreasing = TRUE)
> d <- data.frame(word = names(v), freq=v)
> head(d, 10)
                word freq
cherry       cherry 5096
fruit         fruit 4798
acidity     acidity 3314
tannins     tannins 2970
finish       finish 2722
red             red 2694
palate       palate 2486
black         black 2433
raspberry raspberry 2268
ripe           ripe 2143
>#repeat for the cabernet sauvignon and the results are different,
> cabsav <- subset(wine, variety == "Cabernet Sauvignon")
> 
> descriptors <- Corpus(VectorSource(cabsav$description))
> 
> 
> # Convert the text to lower case
> descriptors <- tm_map(descriptors, content_transformer(tolower))
Warning message:
In tm_map.SimpleCorpus(descriptors, content_transformer(tolower)) :
  transformation drops documents
> # Remove numbers
> descriptors <- tm_map(descriptors, removeNumbers)
Warning message:
In tm_map.SimpleCorpus(descriptors, removeNumbers) :
  transformation drops documents
> # Remove english common stopwords
> descriptors <- tm_map(descriptors, removeWords, stopwords("english"))
Warning message:
In tm_map.SimpleCorpus(descriptors, removeWords, stopwords("english")) :
  transformation drops documents
> # Remove your own stop word
> # specify your stopwords as a character vector
> descriptors <- tm_map(descriptors, removeWords, c("wine", "drink", "cabernet", "flavors")) 
Warning message:
In tm_map.SimpleCorpus(descriptors, removeWords, c("wine", "drink",  :
  transformation drops documents
> # Remove punctuations
> descriptors <- tm_map(descriptors, removePunctuation)
Warning message:
In tm_map.SimpleCorpus(descriptors, removePunctuation) :
  transformation drops documents
> # Eliminate extra white spaces
> descriptors <- tm_map(descriptors, stripWhitespace)
Warning message:
In tm_map.SimpleCorpus(descriptors, stripWhitespace) :
  transformation drops documents
> # Text stemming
> #descriptors <- tm_map(descriptors, stemDocument)
> 
> # Build a term-document matrix
> dtm <- TermDocumentMatrix(descriptors)
> dtm_mat <- as.matrix(dtm)
> v <- sort(rowSums(dtm_mat),decreasing=TRUE)
> d <- data.frame(word = names(v),freq=v)
> head(d, 10)
                 word freq
tannins       tannins 3402
black           black 3162
fruit           fruit 2956
cherry         cherry 2688
finish         finish 2557
aromas         aromas 2387
oak               oak 2377
blackberry blackberry 2239
palate         palate 1978
cassis         cassis 1580
> 
> # Generate the Word cloud
> set.seed(1234)
> wordcloud(words = d$word, freq = d$freq, min.freq = 1,
+           max.words=200, random.order=FALSE, rot.per=0.35, 
+           colors=brewer.pal(8, "Dark2"))


> #split to test/train set
> set.seed(546)
> smp_size<- floor(0.8* nrow(wine))
> train_ind<- sample(seq_len(nrow(wine)), size = smp_size)
> train<- wine[train_ind, ]
> test<- wine[-train_ind, ]
> wine_explore <- wine %>% 
+     select(description, points) %>%
+     mutate(description = gsub('[[:punct:] ]+',' ',tolower(description)))
> 
> words <- str_split(wine_explore$description, ' ')
> all_words <- data.frame(points = rep(wine_explore$points, sapply(words, length)), words = unlist(words))
> words_group<- all_words %>%
+ group_by(words) %>%
+ summarise(points = mean(points), count = n()) %>%
+ filter(count >20) %>%
+ arrange(desc(points))
Warning messages:
1: In doTryCatch(return(expr), name, parentenv, handler) :
  display list redraw incomplete
2: In doTryCatch(return(expr), name, parentenv, handler) :
  invalid graphics state
3: In doTryCatch(return(expr), name, parentenv, handler) :
  invalid graphics state
> top<- words_group[1:10, ] %>% cbind(top_bottom = 'Top')
Warning messages:
1: In doTryCatch(return(expr), name, parentenv, handler) :
  display list redraw incomplete
2: In doTryCatch(return(expr), name, parentenv, handler) :
  invalid graphics state
3: In doTryCatch(return(expr), name, parentenv, handler) :
  invalid graphics state
> bottom<- words_group[(nrow(words_group)-9):nrow(words_group),] %>% cbind(top_bottom = 'bottom')
> top_bottom <- rbind(top, bottom)
> top_bottom
            words   points count top_bottom
1       2020–2035 94.47619    21        Top
2            2035 94.37500    24        Top
3         endless 94.12245    49        Top
4       2020–2032 94.07407    27        Top
5           93–95 94.00000    22        Top
6      stunningly 94.00000    35        Top
7        now–2030 93.97500    40        Top
8        incisive 93.95455    22        Top
9       2017–2030 93.84211    38        Top
10       wondrous 93.67742    31        Top
11           dull 83.37402   254     bottom
12         watery 83.36797   231     bottom
13      fruitless 83.29032    31     bottom
14          bland 83.27650   217     bottom
15        sketchy 83.19512    41     bottom
16 underdeveloped 83.00000    27     bottom
17          stale 82.89286    28     bottom
18     sauerkraut 82.78261    23     bottom
19     acceptable 82.71429    70     bottom
20          weird 82.48000    50     bottom
> define the cleaning function
Error: unexpected symbol in "define the"
> #define the cleaning function
> clean <- function(train, set) {}
> clean <- function(train, set) { 
+ prep_fun <- tolower
+ tok_fun <- function(x) {
+ word_tokenizer(x) %>% lapply(function(x) SnowballC::wordStem(x, language='en'))
+ }
+ }
> library(text2vec)
> clean <- function(train, test) {
+ prep_fun <- tolower
+ tok_fun <- function(x) {word_tokenizer(x) %>% lapply(function(x) SnowballC::wordStem(x, language='en'))}}
> it_train<- itoken(train$description, preprocessor = prep_fun, tokenizer = tok_fun, ids = train$X1, progressbar = T)
Error in .subset2(public_bind_env, "initialize")(...) : 
  object 'prep_fun' not found
> clean <- function(train, test) {
+ prep_func <- tolower
+ tok_func <- function(x) {word_tokenizer(x) %>% lapply(function(x) SnowballC::wordStem(x, language='en'))}}
> train$description<- as.character(train$description)
> it_train<- itoken(train$description, preprocessor = prep_func, tokenizer = tok_func, ids = train$X1, progressbar = T)
Error in .subset2(public_bind_env, "initialize")(...) : 
  object 'prep_func' not found
> library(data.table)
data.table 1.12.0  Latest news: r-datatable.com

Attaching package: ‘data.table’

The following objects are masked from ‘package:dplyr’:

    between, first, last

The following objects are masked from ‘package:lubridate’:

    hour, isoweek, mday, minute, month, quarter, second, wday, week, yday, year

> prep_fun = tolower
> tok_fun = word_tokenizer
> it_train = itoken(train$description, preprocessor = prep_fun, tokenizer = tok_fun, ids = train$X1, progressbar = TRUE)
> > vocab <- create_vocabulary(it_train, stopwords = stopwords('en'), ngram =c(1L, 2L))
  |============================================================================================================| 100%
> head(vocab, 10)
Number of docs: 95964 
174 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
                    term term_count doc_count
 1:     highlights_sweet          1         1
 2: grapes_indeterminate          1         1
 3:         wise_sharply          1         1
 4:           aromas_end          1         1
 5:      standard_medium          1         1
 6:       growing_cooler          1         1
 7:  countering_lushness          1         1
 8:       doling_morello          1         1
 9:      enhances_rennet          1         1
10: strawberry_medicinal          1         1
> pruned_vocab <- prune_vocabulary(vocab, term_count_min = 10, doc_proportion_max = 0.5, doc_proportion_min = 0.001)
> head(prune_vocab, 10)
Error in head(prune_vocab, 10) : object 'prune_vocab' not found
> head(pruned_vocab, 10)
Number of docs: 95964 
174 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
              term term_count doc_count
 1: will_certainly         96        96
 2:         pushes         96        96
 3:   flavors_lead         96        96
 4:   palate_tight         96        96
 5:    green_plums         96        96
 6:  hints_vanilla         96        96
 7:     juicy_wild         96        96
 8:   flavors_fine         96        96
 9:   texture_rich         96        96
10:      along_way         96        96
> > #create the document term matrix
> vectorizer <-vocab_vectorizer(pruned_vocab)
> dtm_train <- create_dtm(it_train, vectorizer)
  |============================================================================================================| 100%
> #define tfidf model
tfidf <-TfIdf$new()
dtm_train_tfidf <- fit_transform(dtm_train, tfidf)
it_test <- itoken(test$description, preprocessor = prep_fun, tokenizer = tok_fun, ids = test$X1, progressbar = TRUE)
dtm_test_tfidf <- create_dtm(it_test, vectorizer) %>%
transform(tfidf)

list('train' = as.matrix(cbind(dtm_train_tfidf, train$price)), 'test' = as.matrix(cbind(dtm_test_tfidf, test$price)))
>> list('train' = as.matrix(cbind(dtm_train_tfidf, train$points)), 'test' = as.matrix(cbind(dtm_test_tfidf, test$points)))

#Currently I am trying to download the Lightgbm package but could not do so yet. So I am using the glmnet to build the prediction model
> summary(dtm_train)
   Length     Class      Mode 
432317820 dgCMatrix        S4 
> View(dtm_train)
> dtm_train2<-cBind(train$len, dtm_train)
Error in cBind(train$len, dtm_train) : could not find function "cBind"
> dtm_train2<-cbind(train$len, dtm_train)
> dtm_test2<-cbind(test$len, dtm_test)
Error in cbind(test$len, dtm_test) : object 'dtm_test' not found
> View(tfidf)
> dtm_traintfidf2<-cbind(train$len, dtm_train_tfidf)
> dtm_testfidf2<-cbind(test$len, dtm_test_tfidf)
> glmnet_classifier = cv.glmnet(x = dtm_traintfidf2, y = train$[['price']],
Error: unexpected '[[' in "glmnet_classifier = cv.glmnet(x = dtm_traintfidf2, y = train$[["
> NFOLDS = 4
> t1 = Sys.time()
> library(glmnet)
Loading required package: Matrix
Loading required package: foreach
Loaded glmnet 2.0-16

> glmnet_classifer = cv.glmnet(x = dtm_traintfidf2, y = train[['price']],
+ family = 'gaussian')
> plot(glmnet_classifer)
> coef(glmnet_classifer)
sweet_simple            -3.4466734
finish_marked           -1.5026266
syrah_grenache           9.5029598
wine_little              .        
mushroomy                .        
pea                      .        
finds                   25.7263220
tangerine_acidity       48.2666182
50_blend                 .        
trebbiano               -3.2395485
wine_strong             45.0208047
dolcetto               -25.0498761
french_american         -7.7345487
blueberry_flavors      -12.8442026
evolving                 9.9595769
wineries               -11.8444304
2018_2028              -25.3480243
soft_gentle              2.2046470
light_red               -1.9336020
sauvignon_blend        -27.2534102
loud                    -4.3643787
notes_drink             21.2898306
hint_white               .        
wine_whose             -27.6186046
.....(more rows)
> glmnet_classifer = cv.glmnet(x = dtm_traintfidf2, y = train[['points']],
+                              family = 'gaussian', nfold = NFOLDS)
> plot(glmnet_classifer)
> preds = data.frame(id=test$points, predict(glmnet_classifer, dtm_test_tfidf))
> 
> View(glmnet_classifer)
> preds
      id       X1
6     87 87.06954
19    87 88.10412
28    87 88.16401
40    86 88.22550
42    86 85.26195
45    86 88.08362
47    86 86.35021
50    86 87.90242
56    85 87.06147
65    86 86.38236
67    86 85.99167
84    86 88.89845
91    88 87.23672
101   87 88.12729
103   87 86.66843
109   87 86.98534
139   90 92.64002
144   91 90.54807
> coef(glmnet_classifer,s =0.01)
interesting         -0.127496100
short               -4.920844701
purple               0.308923056
wine_full           -0.265614384
dark_fruit           0.291587765
plum_flavors         .          
long_finish          0.262211492
least                3.439696900
grained_tannins      .          
astringent          -4.052679067
plums                0.460307123
chunky              -1.000305766
set                  .          
raw                 -2.132171133
wine_will            0.376029408
grown                0.096020635
fermented            0.570775904
back                 .          
flavored            -2.249075100
take                 .          
aroma               -1.642278380
tightly              1.447825871
go                   .          
focused              3.907850859
carry                .          
midpalate            .          
somewhat            -2.512910614
raisin              -0.219242917
buttered             .          
racy                 0.727373114
2015                 1.100895984
without              .          
beautifully          7.411183242
mild                -0.482209433
cherry_raspberry     .          
5                    0.133871467
backed               .          
berry_aromas         .          
tomato              -0.612159957
front                .          
bordeaux            -0.901571543
leaf                 .          
ripe_black           .          
straightforward     -3.269880062
lead_nose            .          
smells              -2.899962180
acidic              -2.920016272
plump                .          
despite              .          
touches             -0.811772921
finishing            .          
soon                -0.875169731
many                 .          
based                .          
produced             0.457430426
grained              0.409328951
wood_aging           .          
opens_aromas         .          
red_currant          .          
sip                  1.663249655
berry_fruit          .          
potential            .          
blossom              0.502987601
wet                  .          
baking_spice         .          
beautiful            7.786159426
spice_flavors       -0.505264437
raspberries          .          
ripeness             .          
juice               -1.252719030
forest               1.645139036
pie                  .          
white_peach          1.978275570
length               2.507962252
pleasant            -2.420919073
though              -0.406296565
french_oak           0.344543532
overall             -1.306758902
better               .          
olive                0.171694367
accented            -0.012891085
dark_chocolate       0.582654450
variety              .          
provide              0.496484822
drink_2017           2.117831887
skin                -0.570041755
pink                -0.352040799
cellar               3.970655151
cab                 -1.861223066
accents              0.016762015
cocoa                0.046648332
apples               .          
sense                0.989402497
aromas_flavors      -1.143325786
lots                 .          
nectarine            0.770783653
blue                 1.267431176
adds                 0.480641269
add                  .          
months              -0.878143542
sage                 1.072926915
food                -0.601629230
prune               -0.185476794
fruit_aromas         0.009239920
wine_offers          .          
classic              2.423922211
expression           .          
around               0.616458214
red_fruits          -0.316120570
driven               0.339087240
petit_verdot         .          
verdot               1.259217647
two                  .          
bodied_wine          .          
fruity_wine         -1.480957147
impressive           6.657763107
open                 .          
sugar               -1.301473703
rosé                -3.013924375
vines                1.336704853
wine_shows           .          
fresh_acidity        0.016406607
flavors_finish       .          
varietal            -0.748596138
elegance             3.129483123
fragrant             .          
taste               -2.527499666
tropical_fruit      -0.204457996
tea                  0.599996232
ripe_fruit           0.727564966
sauvignon_blanc     -1.307384221
enjoy               -0.186707217
petit                .          
supple               1.685213867
cool                 0.180676988
packed               1.801490361
price               -1.939868326
10                   0.234625803
develop              1.112009793
nicely               .          
wine's              -0.493111255
chewy                .          
intensity            1.568627730
giving               .          
cut                  0.545902826
sangiovese          -1.113865663
bright_acidity       0.285836264
sharp               -3.839721136
palate_delivers      0.436519853
integrated           2.631547336
already              .          
cherry_flavors       .          
100                  .          
quality             -0.053658672
violet               2.013420881
acids               -2.070883662
2019                 5.569093384
crisp_acidity        .          
cherry_fruit         .          
vineyards            2.597275187
brisk               -1.465851038
grilled              .          
black_fruits         .          
valley               0.292124314
currants            -0.158140060
tannin              -1.031402606
polished             3.044145300
french               .          
can                  0.863001159
lovely               4.512773873
berry_flavors        .          
berry_fruits        -0.005666718
tangerine            0.897303397
layered              2.997196194
nose_palate          .          
close               -1.248066242
lingering            2.284097802
black_plum           .          
grenache             .          
seems               -1.965000781
bouquet             -0.548305253
green_apple          1.825087047
2016                 0.032984345
velvety              4.873084504
flowers              0.172237446
side                -1.030664077
finish_drink         .          
sour                -5.574220642
blackberries        -0.378712158
stone_fruit          .          
firm_tannins         .          
old                  .          
next                 0.143354578
berries              .          
rather              -1.394568432
lean                -4.978906611
meat                 0.707121469
year                 0.103930818
exotic               2.248714557
heavy               -3.872716593
whiff                .          
thick               -0.769433618
brings               0.745114311
espresso             0.397114549
jam                 -2.731613663
peel                 2.008244718
together             0.293887560
cabernet_franc       0.421594642
fruitiness          -2.007726480
riesling            -0.021179243
drink_2018           0.721483018
right                0.782838895
peppery              .          
even                 1.011564347
malbec               .          
first                1.368360496
caramel             -0.092403699
pair                -2.948234217
estate               1.163328544
pure                 4.470508533
baking               2.083961614
sweetness           -1.354867961
power                4.383768468
makes                .          
red_cherry           1.162677483
white_pepper         3.304224490
candied             -2.340363904
needs               -0.500303473
bold                 1.243822046
offering             .          
vibrant              2.276974615
dusty               -0.494446898
grape               -0.798164276
lush                 3.496380861
depth                3.018012555
mix                  0.281763904
hard                -2.251212638
rose                 0.985693376
way                 -0.254847416
mint                 .          
subtle               0.461080769
forward             -0.169919143
enough              -1.203028722
warm                -0.392415823
layers               0.988217858
anise                0.793135156
although            -0.437058173
bottle               0.583319649
aromatic             0.301042484
deep                 4.433812755
end                  .          
red_fruit            .          
nice                -0.375165290
followed            -0.446064512
zesty                0.319303343
wines                0.478162202
roasted              0.819876935
tones               -1.789271977
mature               0.644395431
aftertaste          -1.661606439
delicate             .          
black_pepper         0.308159648
jammy               -2.076930447
rounded              .          
powerful             5.177520176
perfumed             .          
2020                 9.659385581
oaky                -1.312861128
franc                .          
aged                 0.949328572
smoke                0.015454263
2017                 2.284984989
strong              -0.967525381
almond               .          
blanc               -1.385690138
silky                2.053902356
mocha                0.536028782
concentration        1.082320682
spices               1.479152979
textured             0.430775473
toasted              0.082488617
drinking            -1.847042585
red_berry           -0.639078189
flower              -0.224264118
much                -3.420585101
black_currant       -1.014497659
cedar                .          
blueberry            0.622401753
grapes               .          
comes                0.036424478
zest                 0.905531128
pinot_noir           .          
glass                1.577670283
body                 .          
cranberry            0.275377897
toasty               1.784642928
noir                 .          
quite               -1.557782710
pretty              -0.760503010
medium_bodied        .          
crushed              1.454444585
bitter              -5.489253982
make                 .          
gives                .          
edge                -0.833322481
tangy                .          
generous             2.869724982
show                -0.645024109
plenty              -0.393003578
lightly             -0.601952030
scents               .          
complexity           3.781397480
minerality           3.576982320
black_fruit          .          
baked                .          
alcohol             -1.889948863
bottling             2.759680361
showing              0.057000543
finishes            -1.546230441
refreshing           0.174464943
cinnamon             1.748606405
core                 1.144927365
round                .          
tastes              -2.996337245
apricot              .          
barrel               0.446264060
solid                .          
tropical            -0.506639060
come                 .          
floral               0.200821477
best                 2.187228344
attractive          -2.358182862
earth                0.676730417
weight               .          
pineapple           -0.513037574
intense              3.011438696
simple              -7.085021275
stone                0.218640050
2018                 6.523012232
little              -2.764939417
high                 .          
wild                 1.126989022
clove                0.285228702
feel                -1.073456445
almost               .          
palate_offers       -1.399438410
grapefruit           0.276754695
honey                0.659676019
melon               -0.356706997
coffee               0.995283476
big                  .          
delivers             0.477843122
color               -1.241651775
ready_drink         -2.792621126
feels               -0.965606574
cola                 0.062015737
yellow               0.557452218
cherries            -0.141604033
lively               0.603496807
vintage              1.780256602
strawberry          -0.086497449
freshness            1.848760877
smoky                .          
young                .          
time                 1.488262441
herbs                1.161341341
cassis               2.498805036
richness             3.861343558
new                  2.183926937
mouthfeel           -0.674883034
complex              7.654605819
chardonnay          -1.766747192
yet                  3.385353980
easy                -4.155807959
hints               -0.892076480
slightly            -2.036018128
elegant              4.474963386
great                4.715296523
lead                -0.023300886
earthy              -0.228536683
ready                .          
savory               1.247989149
tobacco              0.585231886
cabernet_sauvignon   1.139685624
leather              .          
alongside            .          
delicious            6.859486740
tight                0.219833985
structured           2.028342906
dense                2.851822621
syrah               -0.734832462
along                .          
aging                1.902307739
opens                .          
balance              0.820107695
one                  1.076313007
toast                0.494508229
give                 .          
creamy               .          
clean               -1.252410732
lime                 0.419150107
age                  2.075955224
bit                 -2.316696020
orange               .          
merlot              -2.441474037
hint                -1.131154986
still                1.022844375
licorice             2.344011757
flavor              -2.442750079
note                -1.672515953
vineyard             5.140397398
herbal              -2.049248262
tart                -2.284786987
mineral              2.821061955
also                 .          
tannic              -2.076085642
concentrated         3.814817837
herb                 0.222353219
long                 7.954341714
just                 .          
style               -0.491918141
mouth               -0.849576960
currant              .          
medium              -4.191097316
pinot               -0.186967650
full_bodied          .          
made                 .          
wood                -0.186001354
fine                 2.482257367
smooth               0.605007277
spicy                .          
fruit_flavors        2.261306921
structure            0.701304118
sauvignon            .          
pear                 .          
years                7.035179335
dried                .          
black_cherry         0.302033104
will                 .          
character           -2.154720493
like                -1.470610748
touch               -0.160581996
balanced             2.441456637
peach               -0.383112371
chocolate            1.675672262
firm                 1.184156637
lemon                .          
raspberry            .          
fruity              -3.623107609
good                -1.867586986
green               -3.697012009
juicy                0.253006543
pepper               .          
drink_now           -4.051599702
cabernet             .          
bright               .          
vanilla             -0.376539198
bodied               .          
citrus              -0.448435446
shows               -0.219287668
dark                 1.764291083
texture              .          
offers              -1.424563297
light               -3.396310563
crisp               -2.217155098
white               -1.283034697
blackberry           .          
blend               -0.565669767
apple               -0.699441465
well                 1.079596636
fruits              -0.023132606
sweet               -3.677081537
soft                -5.268109129
plum                 .          
full                 1.354506991
nose                -2.943361806
berry               -0.690797640
now                  0.681303980
dry                 -2.902678808
fresh                .          
rich                 5.705631091
oak                 -1.980711288
notes               -2.055693956
spice                0.372373255
red                 -3.441742112
ripe                 0.794837229
black                2.293712904
cherry              -1.362727552
drink               -1.423984190
tannins             -2.404924417
acidity             -2.657428168
finish              -2.408405524
palate              -1.585033290
aromas              -5.664229253
fruit               -4.154015406
flavors            -12.485613403
wine                -7.025910216
...

$glmnet.fit

Call:  glmnet(x = dtm_traintfidf2, y = train[["points"]], family = "gaussian") 

        Df     %Dev    Lambda
 [1,]    0 0.000000 0.6778000
 [2,]    1 0.008139 0.6176000
 [3,]    2 0.017920 0.5627000
 [4,]    2 0.028240 0.5127000
 [5,]    3 0.038250 0.4672000
 [6,]    3 0.048660 0.4257000
 [7,]    6 0.062570 0.3879000
 [8,]   13 0.086400 0.3534000
 [9,]   18 0.110200 0.3220000
[10,]   23 0.136800 0.2934000
[11,]   35 0.166100 0.2673000
[12,]   44 0.196800 0.2436000
[13,]   51 0.225600 0.2220000
[14,]   60 0.253000 0.2022000
[15,]   71 0.280600 0.1843000
[16,]   83 0.305700 0.1679000
[17,]  101 0.330100 0.1530000
[18,]  121 0.354300 0.1394000
[19,]  138 0.377500 0.1270000
[20,]  159 0.399200 0.1157000
[21,]  177 0.419500 0.1054000
[22,]  206 0.438100 0.0960800
[23,]  238 0.455700 0.0875400
[24,]  286 0.472500 0.0797600
[25,]  322 0.488300 0.0726800
[26,]  364 0.503200 0.0662200
[27,]  414 0.517200 0.0603400
[28,]  458 0.530100 0.0549800
[29,]  521 0.542300 0.0500900
[30,]  583 0.553400 0.0456400
[31,]  641 0.563800 0.0415900
[32,]  704 0.573300 0.0378900
[33,]  773 0.582100 0.0345300
[34,]  870 0.590200 0.0314600
[35,]  953 0.597800 0.0286700
[36,] 1045 0.604800 0.0261200
[37,] 1141 0.611200 0.0238000
[38,] 1234 0.617100 0.0216800
[39,] 1344 0.622500 0.0197600
[40,] 1447 0.627600 0.0180000
[41,] 1558 0.632100 0.0164000
[42,] 1682 0.636300 0.0149500
[43,] 1801 0.640200 0.0136200
[44,] 1922 0.643700 0.0124100
[45,] 2056 0.647000 0.0113100
[46,] 2177 0.649900 0.0103000
[47,] 2299 0.652600 0.0093870
[48,] 2402 0.654900 0.0085530
[49,] 2520 0.657100 0.0077930
[50,] 2649 0.659000 0.0071010
[51,] 2772 0.660700 0.0064700
[52,] 2875 0.662200 0.0058950
[53,] 2983 0.663500 0.0053710
[54,] 3097 0.664700 0.0048940
[55,] 3191 0.665800 0.0044590
[56,] 3282 0.666700 0.0040630
[57,] 3380 0.667500 0.0037020
[58,] 3469 0.668200 0.0033730
[59,] 3526 0.668800 0.0030740
[60,] 3595 0.669400 0.0028010
[61,] 3671 0.669900 0.0025520
[62,] 3731 0.670300 0.0023250
[63,] 3781 0.670600 0.0021190
[64,] 3827 0.670900 0.0019300
[65,] 3893 0.671200 0.0017590
[66,] 3944 0.671400 0.0016030
[67,] 3990 0.671600 0.0014600
[68,] 4027 0.671800 0.0013310
[69,] 4066 0.671900 0.0012120
[70,] 4106 0.672000 0.0011050
[71,] 4142 0.672100 0.0010070
[72,] 4166 0.672200 0.0009171
[73,] 4192 0.672300 0.0008356
[74,] 4223 0.672400 0.0007614
[75,] 4238 0.672400 0.0006938
[76,] 4262 0.672500 0.0006321
[77,] 4280 0.672600 0.0005760
[78,] 4304 0.672600 0.0005248
[79,] 4327 0.672600 0.0004782
[80,] 4338 0.672700 0.0004357
[81,] 4355 0.672700 0.0003970
[82,] 4365 0.672700 0.0003617
[83,] 4374 0.672700 0.0003296
[84,] 4384 0.672700 0.0003003
[85,] 4398 0.672800 0.0002736
[86,] 4406 0.672800 0.0002493
[87,] 4409 0.672800 0.0002272
[88,] 4413 0.672800 0.0002070
[89,] 4419 0.672800 0.0001886
[90,] 4425 0.672800 0.0001718

$lambda.min
[1] 0.004063324

$lambda.1se
[1] 0.006469961

attr(,"class")
[1] "cv.glmnet"
#2nd try on the model
>glmnet_classifer2 = cv.glmnet(x = dtm_traintfidf2, y = train[['points']])
>coef_glmnetclassifer2 = coef(glmnet_classifer2, s = "lambda.min")
>coef_glmnetclassifier2
ints_vanilla           .          
juicy_wild              1.457592733
flavors_fine            .          
texture_rich           -0.225615160
along_way              -0.516097562
scour                   .          
acidity_minerality      0.858946857
aromas_orange          -1.199256055
silk                    2.191390619
pinched                -1.740853866
tannins_grip            .          
drink_immediately      -1.064274722
meant                   .          
packed_tannins          .          
slightly_herbal         0.228018408
mixing                 -0.744771149
>predict(glmnet_classifer2, dtm_testfidf2, s= "lambda.min")
> pred2 = data.frame(price= test$points, predict(glmnet_classifer2, dtm_testfidf2, s= "lambda.min"))
> pred2
     price       X1
6       87 87.01192
19      87 88.07445
28      87 87.93141
40      86 88.14954
42      86 85.08234
45      86 87.91136
47      86 86.41557
50      86 87.83164
56      85 87.14959
>print(glmnet_classifier2)

$lambda.min
[1] 0.003073756

$lambda.1se
[1] 0.005371475

attr(,"class")
[1] "cv.glmnet"

Final Try - use the dtm_tfidf straight( not the $len one)
> glmnet_classifier3=cv.glmnet(x = dtm_train_tfidf, y = train[['points']])
> plot(glmnet_classifier3)
> pred3 = data.frame(price= test$points, predict(glmnet_classifier3, dtm_test_tfidf, s= "lambda.min"))
> print(glmnet_classifier3)

$lambda.min
[1] 0.003373443

$lambda.1se
[1] 0.005371475

attr(,"class")
[1] "cv.glmnet"
>pred3
> plot(glmnet_classifier3)
> mean(pred3$price-pred3$X1)
[1] -0.02976144
> mse<- mean((pred3$price - pred3$X1)^2)
> print(mse)
[1] 3.440355
> write.csv(pred3, file = "pred3.csv", row.names = FALSE, quote = FALSE)
---------------------------------------------------------------------
#2nd try on glmnet classifier.Note that line 970 to 989 i realize i was cbind with teh price, and when trying with points, it ran out of memory, so i didnot do that step and went straight to glmnet using dtm_train_tfidf and dtm_test_tfidf
> fit = cv.glmnet(x = dtm_train_tfidf, y = train[['points']], type.measure = "mse", nfolds = 20)
> > plot(fit)
> fit$lambda.min
[1] 0.003073756
> glmnet_classifer$lambda.min
[1] 0.003702349
#compared with last time, teh fit model brings less error
> preds2 = data.frame(id=test$points, predict(fit, dtm_test_tfidf, type = "response", s = 0.05))
> preds2
> print(fit)
$lambda.min
[1] 0.003073756

$lambda.1se
[1] 0.005371475

attr(,"class")
[1] "cv.glmnet"
coef(fit, s = "lambda.min")
hints_vanilla           .          
juicy_wild              1.457592733
flavors_fine            .          
texture_rich           -0.225615160
along_way              -0.516097562
scour                   .          
acidity_minerality      0.858946857
aromas_orange          -1.199256055
silk                    2.191390619
pinched                -1.740853866
tannins_grip            .          
drink_immediately      -1.064274722
meant                   .          
packed_tannins          .          
slightly_herbal         0.228018408
mixing                 -0.744771149
tart_flavors            .          
fruit_accented          0.075839648
flower_aromas           .          
based_blend            -0.258001508
extend                  0.220235302
showy                   0.129459125
alongside_tightly       .          
work_well              -1.526843696
effortlessly            3.368050091
production_wine         1.230476600
grilled_meats          -1.252774304
chops                  -1.392757368
acidity_hint            0.390449154
sonoma_coast            0.675608028
bottling_palate        -1.767093635
measure                -0.561635955
dried_plum             -0.455185539
feature                 .          
greens                  0.111994817
bright_lemon           -0.579526933
right_front            -0.129623084
flavors_texture         1.366850892
quickly_drink          -2.521534507
doles_ripe              1.037736183
tannins_frame          -0.175862348
pair_wine               .          
breathes                1.753598686
touch_tannin            .          
anjou_pear              0.331163762
dry_flavors             .          
spicy_plum             -1.531315998
time_develop            0.081656055
mossy                   1.086003213
aromas_pear            -0.371871147
texture_ripe            .          
dinner_table            .          
east                    0.156475800
flavors_grapefruit      0.066341210
deep_color             -0.130075242
flavors_lightly         .          
well_now                .          
g                       1.843212358
mature_berry           -0.911559802
toasty_character        0.315277013
packed_fruit            0.617143450
sugary_sweet           -0.103154782
old_world               0.148265966
inexpensive            -2.446165723
party                  -1.535840959
pineapple_mango        -0.592575956
acidity_shows           1.938238172
balanced_tannins        .          
rather_later            .          
structure_acidity      -0.240982517
hide                    .          
light_easy             -0.187464366
called                  .          
dancing                 0.892201887
nose_ripe               1.766260640
peppery_finish          .          
hailing                -0.038014914
blackberry_boysenberry  1.781166246
vineyards_wine          0.422774362
riesling_palate         1.722843877
persimmon              -0.130827425
estates                -0.435156555
hardly                 -1.102691888
wine_hints             -1.039452885
palate_balanced         .          
soaked                  1.349023906
fierce                  0.267493687
pineapple_jam          -1.039209997
balance_drink          -0.725047230
bacon_fat               1.788143957
red_color               .          
yields                  1.504813182
delicious_drink        -0.545196095
reserva                 1.818158479
can_drunk               .          
grating                -2.340512712
best_2020               1.630205848
blackberry_pie         -0.529074672
mangoes                -0.778184460
vineyard_planted        1.243324093
apple_flavor            0.349658599
sauvignon_petit         0.629413177
served                  .          
touch_bitter           -0.093790251
melon_rind             -0.951103830
rounds                  .          
appellation_blend       .          
sweet_simple           -0.774662466
finish_marked           1.264937944
syrah_grenache         -0.878737839
wine_little            -1.237214698
mushroomy              -1.051415031
pea                     0.061723741
finds                   0.512176806
tangerine_acidity      -0.166530061
50_blend                .          
trebbiano              -1.620808991
wine_strong            -0.869805127
dolcetto               -2.747885308
french_american         .          
blueberry_flavors      -0.693108124
evolving                2.432316026
wineries               -0.418257266
2018_2028               .          
soft_gentle            -1.155529409
light_red              -0.248046406
sauvignon_blend        -0.257996387
loud                   -0.601803225
notes_drink             0.208515433
hint_white             -1.341173260
wine_whose             -0.140117484
clumsy                 -4.514233419
enjoyable_now           1.675773392
cotton                 -0.894174044
ruby_color             -1.653760835
drink_young            -1.687511549
fruit_structure         0.169759419
piquant                 0.350949121
getting                -0.524137115
offers_red             -0.391078441
structural              0.090087806
lemon_pith              0.675656959
dominate_nose          -0.472574857
vigorous               -1.005050817
finish_full             0.510141863
tannins_long            .          
grape_variety           .          
buttery_oak            -0.933140969
smoky_character         .          
cough                  -2.293897591
cherry_ripe             .          
acidity_tangy           .          
add_interest           -0.264200940
aromas_berry           -0.030063894
finish_brings           .          
smoky_vanilla          -1.674911111
monterey               -1.294736499
evolution               .          
fruit_sourced           .          
picks                   .          
anise_flavors          -2.568952779
plum_prune              0.228443683
creamy_flavors          0.531243302
number                  0.280087869
aromas_oak              0.690462128
fruits_crisp            .          
breathe                 0.170811940
challenging            -0.337771285
zing                    0.381992554
lodi                   -2.326723282
primary_fruit           0.894751613
lies                   -0.069090058
touch_acidity          -1.030591222
soft_juicy             -0.088227713
grip_finish            -1.084347478
bodied_style           -1.591171566
flavors_delicious      -0.950546975
cranberry_pomegranate   0.432725097
fruit_dried             .          
meringue                0.744231789
gingerbread             2.954705115
just_ripe               0.360082811
smith_apple            -0.406115980
consistently            0.554101538
espresso_bean           2.608293552
people                 -1.368945312
pommard                 1.319522259
aromas_forest           .          
good_depth              .          
dry_balanced            .          
100_new                 2.483353959
laser                   4.940527246
subtle_oak              1.344378903
blow                   -3.419125688
steeped                 .          
flavors_cut             0.382432688
stony_minerality       -0.817914469
quaff                  -0.745429800
lie                     .          
extends                 1.544046843
small_amounts           0.164315212
percentages            -1.698708341
finest                  5.317068966
drunk_young            -2.319943909
structured_red          2.117233767
herbal_finish           0.162906309
feel_mouth             -0.269775023
owner                   1.124118715
ribs                   -0.702847732
finish_give             .          
tobacco_leather         .          
influenced              .          
drinking_well           0.200490504
palate_displays        -0.135023250
citrus_melon           -0.226865783
tart_finish            -1.806084910
young_fruity           -2.720313396
notes_green             0.146168885
possibly                .          
needed                  .          
crème_de                .          
chocolate_anise         .          
mixture                 0.415297577
candied_orange          1.480757256
jammy_flavors           .          
pulling                 0.145444097
2018_2025              -1.531231270
wants                  -0.071425691
flavors_layered        -0.168981079
aspects                 0.215196838
ripe_pineapple          0.111062333
contrasts               .          
flavors_long           -0.225001953
seen                   -2.139756659
pine_needle             0.346792534
vanilla_finish          .          
near_term              -1.697178693
premier_cru             .          
tightly_knit            0.358299055
now_hold                .          
finish_crisp            0.118915470
stay                    .          
little_soft             .          
either                 -1.739124714
acidity_still           .          
impeccably              1.322341154
adequate               -2.089491729
age_many                1.193234031
category               -1.209270463
bulky                  -0.610042954
zesty_lemon             .          
vanilla_coconut         0.770321105
smoky_aromas            1.014728301
great_depth             0.615854862
counoise                0.616642341
oak_aged               -0.427962822
wine_perfumed           .          
spätlese                2.607585163
bitter_edge            -0.294924449
spice_followed          .          
powdered_sage           .          
rum_cake                .          
flavors_go              0.391274624
strikes                 1.465517996
impact                  1.082956220
head                    0.113478823
bitterness_finish      -0.676706383
dry_medium             -0.958055418
licorice_cola           .          
smells_tastes          -0.078667088
fruit_white             .          
still_needs             0.219666529
flavors_mark            .          
enriched                1.292802334
age_another             .          
fresh_flavors           0.497106833
following               0.146558521
peach_honey             .          
wine_displays           .          
woodsy                  0.052731032
bodied_ripe             .          
lemon_orange           -0.850049331
bright_citrus           .          
cherry_dried            .          
age_wine                .          
along_notes            -1.077957512
purple_fruits           0.722210403
raspberry_compote       2.685608481
accenting               .          
intricate               3.907771519
valpolicella           -1.984638429
delivers_aromas         0.350822791
lightly_spicy           .          
chinese                -0.998937386
texture_gives           0.880280535
burgundian              0.989671833
bar                    -2.292476720
offers_notes           -0.152921335
generally              -0.788500796
sniff                   1.948297012
tame                   -0.576708273
rich_character          0.946697231
alentejo               -0.660691054
welcoming               0.443417184
flavors_alongside       .          
unbalanced             -3.681231822
almond_alongside        .          
cassis_chocolate       -0.409802008
19                      1.065089162
structure_will         -0.668889461
acidity_clean          -1.793809064
lushness                2.318825078
said                   -1.295673915
lead_palate             .          
spirit                  .          
currant_cherry         -0.148461394
richness_drink         -0.101981235
alongside_velvety       .          
lemon_green             .          
easy_enjoy              2.028767742
fresh_aromas           -0.017618655
step                    .          
blend_pinot             .          
study                   3.936547687
pointed                 0.006403495
beneath                 1.610745942
notes_fresh             .          
breathing_time          .          
del                    -0.819317584
acidity_mineral         1.028036248
slightly_sour           .          
enticing_scents         2.560114587
caramel_flavors        -1.119928497
family's                0.803304086
fruit_firm              .          
ripe_melon             -0.503187151
theme                  -1.222516357
thickness              -0.812899219
golden_apple            .          
crisp_lemon            -0.810518935
foxy                   -2.119473583
retaining               1.880734701
based_wine              .          
tannin_structure        .          
deft                    1.801065296
dough                   0.143404515
full_palate             .          
tannins_balanced       -0.344537135
balanced_palate         1.674352930
touch_minerality       -1.623318675
palate_round           -1.050386648
ripe_round              .          
rim                     .          
brims                   .          
flowery                -0.872130428
cushioned               2.631935696
irresistible            4.358223209
major                   1.821722291
wine_generous           0.370291264
forceful                0.164992241
hint_vanilla            .          
texture_smooth          .          
clove_flavors           .          
licorice_tobacco        1.551176134
flavors_pear            .          
imparts                 .          
offers_flavors          .          
now_2013                3.331721426
toasted_hazelnut        .          
mediterranean_herbs     1.515368300
wine_touch             -1.244793810
aromas_spice            0.495606287
wine_big                .          
decades                 9.019787793
primitivo              -2.157328776
21                      1.236305347
exotic_spices           1.840276557
current                 .          
firm_finish             .          
apple_nectarine        -0.086156532
licorice_clove          1.178301900
ripe_character          .          
developing_well        -0.210288406
chocolate_notes         0.182874515
oak_based               0.464056520
smoothed               -0.700079614
soft_rich               0.077600600
meaning                 0.223933372
satisfy                -0.773871702
wine_young              0.638748568
reductive               .          
aromas_stone           -1.354634661
rich_opulent            0.041690088
natural_acidity         0.532096412
orange_marmalade        .          
touch_pepper           -1.214791285
spice_ripe              .          
raspberry_cinnamon      1.972163376
grapefruit_lime        -0.180374383
night                   .          
beefy                   .          
tire_rubber            -1.503721060
fruits_spice            .          
joy                     4.718457183
poultry                -2.015771212
cherry_coffee           0.998907536
volatile               -3.007974177
mature_fruit           -0.695413848
simple_fruity           .          
fruit_bright            .          
fully_ripe              0.760321362
plum_chocolate         -1.291785867
round_full              .          
evolves                 1.499256885
quenching               1.463157381
fruit_crisp             .          
wine_refreshing         0.449581255
waiting                -0.075311380
apricot_pear           -1.091083006
various                 .          
nose_full               0.415440782
feels_tight             1.909975603
long_time               0.045751487
boned                   .          
earth_leather           .          
balanced_ripe           .          
ways                    0.615229654
grapefruit_pith         .          
touch_honey             0.543531140
becoming                .          
tannic_grip            -0.218557836
peach_pit              -3.135677865
raspberry_licorice      1.269896634
juicy_flavors           0.001062837
crisp_bright           -0.092385578
balancing_acidity      -1.228204785
cherry_dark             .          
tinta                  -0.241682182
acidity_lifts           .          
market                  .          
diluted                -3.664600909
even_though            -1.197660151
berry_baking            0.174664707
kicks                   0.398865510
core_tannins           -0.602777841
breadth                 0.990206377
elevated               -0.241517869
drink_2025              8.970174415
currant_plum            0.066375313
brick                   0.517355440
notes_add               .          
foundation              0.868870326
silky_smooth            1.145655224
aromas_leather         -0.260046851
needle                  0.576092219
shows_bright            .          
role                    .          
abrasive               -0.231816661
darkly                  .          
recent                 -0.358587894
succulence              1.662874158
red_wines              -0.514402898
earthy_berry            .          
late_2016               0.142211717
acidity_black           .          
aromas_crushed          .          
emphasis                0.031254346
low_acidity            -0.381933622
interpretation          .          
core_wine               .          
finish_short           -1.192869142
white_wines            -1.490094668
spice_red               .          
finish_offers           .          
much_like               1.113664161
allows                  0.678087731
quite_ripe             -1.928158278
de_cassis               1.273867388
sage_alongside          .          
soupy                  -1.564943641
teriyaki                1.255093556
wine_quite             -1.786258108
flavors_lime            .          
nose_followed          -0.409574116
citrus_pith            -0.976458474
dried_rose              .          
well_defined            .          
pinot_noirs             0.582517577
finely_structured       .          
white_chocolate         1.241485324
white_blend            -1.286522035
parcels                 2.656605318
balance_fruit           0.070713600
wine_clean             -0.257087876

 ..............................
 ........suppressing rows in show(); maybe adjust 'options(max.print= *, width = *)'
 ..............................

                               1
fleshy               .          
ample                0.860399360
top                  2.843943715
interesting         -0.460139221
short               -4.532720884
purple               .          
wine_full           -0.600786371
dark_fruit           0.324306606
plum_flavors        -0.097832338
long_finish          0.835357045
least                3.657112602
grained_tannins      .          
astringent          -3.899059078
plums                0.555653690
chunky              -0.936612609
set                  0.232120229
raw                 -2.108620338
wine_will            0.974905090
grown                1.105004400
fermented            1.460689303
back                -0.293284165
flavored            -2.550222804
take                 0.470633328
aroma               -1.797035212
tightly              1.528584081
go                   .          
focused              3.753944844
carry               -0.182968932
midpalate           -0.074323013
somewhat            -2.433323135
raisin              -0.296483081
buttered             .          
racy                 1.244704415
2015                 1.595632017
without              .          
beautifully          7.174758277
mild                -0.557908226
cherry_raspberry     0.174979248
5                    0.115656245
backed              -0.199295607
berry_aromas         0.334987217
tomato              -0.670372624
front               -0.375879529
bordeaux            -1.414793048
leaf                 .          
ripe_black           .          
straightforward     -3.192216453
lead_nose            .          
smells              -3.246949766
acidic              -3.059052946
plump                0.279466690
despite              .          
touches             -1.275512619
finishing            .          
soon                -0.715782015
many                 0.133996057
based                .          
produced             0.747982390
grained              1.165358608
wood_aging          -0.084018403
opens_aromas        -0.433618028
red_currant          0.431133198
sip                  1.520126124
berry_fruit          .          
potential            .          
blossom              1.183560982
wet                 -0.254999276
baking_spice         .          
beautiful            7.602240455
spice_flavors       -1.080738146
raspberries          0.259671913
ripeness             .          
juice               -1.628868052
forest               1.951472408
pie                  0.463842764
white_peach          2.691523314
length               2.488407852
pleasant            -2.370988287
though              -0.689606410
french_oak           0.748842075
overall             -1.479460801
better               .          
olive                0.228714452
accented            -0.380698289
dark_chocolate       0.630962218
variety              .          
provide              0.397882531
drink_2017           2.408356109
skin                -0.914751950
pink                -0.385721823
cellar               3.980052500
cab                 -2.138391964
accents              0.269944348
cocoa                0.414763486
apples              -0.349456278
sense                0.878496914
aromas_flavors      -1.680385815
lots                -0.125020253
nectarine            1.141434650
blue                 1.080357784
adds                 0.824316894
add                 -0.368302539
months              -1.450558824
sage                 1.415953911
food                -0.580734337
prune               -0.383872195
fruit_aromas         0.678990395
wine_offers          .          
classic              2.581262078
expression          -0.115803033
around               0.851009564
red_fruits          -0.058321692
driven               0.892892378
petit_verdot         .          
verdot               1.180002504
two                  .          
bodied_wine          .          
fruity_wine         -1.580460342
impressive           6.356688187
open                 0.049929875
sugar               -1.971451417
rosé                -2.958126902
vines                1.169697454
wine_shows           0.315556366
fresh_acidity        0.279474304
flavors_finish       .          
varietal            -1.534675229
elegance             3.006656855
fragrant             .          
taste               -2.564413456
tropical_fruit      -0.306707083
tea                  0.647165686
ripe_fruit           0.995748986
sauvignon_blanc     -0.927466696
enjoy               -0.449243657
petit                .          
supple               1.768732228
cool                 0.303202416
packed               2.112921677
price               -1.972352125
10                   0.787032085
develop              0.866817875
nicely               0.182750083
wine's              -0.870998612
chewy                .          
intensity            1.753125945
giving               0.002645050
cut                  1.415910925
sangiovese          -1.264797555
bright_acidity       0.887989341
sharp               -3.632709787
palate_delivers      0.917843193
integrated           2.684100280
already             -0.004070747
cherry_flavors       .          
100                  .          
quality             -0.368802491
violet               2.221045272
acids               -2.703394621
2019                 5.762703573
crisp_acidity        .          
cherry_fruit        -0.141243084
vineyards            2.272342536
brisk               -1.526043262
grilled              .          
black_fruits         .          
valley               0.430599855
currants            -0.526886881
tannin              -1.499138731
polished             3.080859966
french               0.199989367
can                  1.401425761
lovely               4.126206761
berry_flavors        .          
berry_fruits        -0.012565041
tangerine            1.101706048
layered              2.896418140
nose_palate          .          
close               -1.465137257
lingering            2.340794400
black_plum           .          
grenache             .          
seems               -1.921202022
bouquet             -1.055291736
green_apple          2.592041743
2016                 0.718826779
velvety              4.775098998
flowers              0.504410424
side                -1.290392927
finish_drink         0.351643070
sour                -5.705519625
blackberries        -0.910111111
stone_fruit         -0.760671125
firm_tannins        -0.394943528
old                  .          
next                 0.860760837
berries             -0.219431322
rather              -1.506486325
lean                -4.714276048
meat                 0.712359251
year                 0.640618067
exotic               2.676508127
heavy               -3.677088011
whiff                .          
thick               -1.048872202
brings               1.097745684
espresso             1.022791525
jam                 -2.642039477
peel                 2.156271832
together             0.730824498
cabernet_franc       0.237319524
fruitiness          -2.047498551
riesling            -0.629311562
drink_2018           1.543507614
right                1.033202188
peppery              0.173663185
even                 1.323291710
malbec               .          
first                1.491823281
caramel             -0.252861937
pair                -2.657945915
estate               1.258110817
pure                 4.410986957
baking               2.207792460
sweetness           -1.528198251
power                4.315621406
makes               -0.204733312
red_cherry           1.830386753
white_pepper         4.247358598
candied             -2.529939106
needs               -1.665483487
bold                 1.323491944
offering             0.180646068
vibrant              2.371310511
dusty               -0.859966816
grape               -0.957215394
lush                 3.464961550
depth                2.913784830
mix                  0.379251897
hard                -2.324010464
rose                 0.858633132
way                 -0.423904207
mint                 .          
subtle               0.707397331
forward             -0.450508211
enough              -1.270203112
warm                -0.508495605
layers               0.953001327
anise                1.203705306
although            -0.669056794
bottle               0.733933483
aromatic             0.480667190
deep                 4.332198093
end                  .          
red_fruit            .          
nice                -0.340193443
followed            -0.734379826
zesty                0.758764105
wines                0.779936626
roasted              1.315770256
tones               -2.063634455
mature               1.199556118
aftertaste          -1.680215564
delicate             0.010307974
black_pepper         1.231392968
jammy               -1.928232484
rounded              0.190625170
powerful             5.106348261
perfumed             .          
2020                 8.639117833
oaky                -1.391402435
franc                0.143226533
aged                 1.165795448
smoke                0.231507583
2017                 2.737645722
strong              -1.137062146
almond               .          
blanc               -1.935882222
silky                2.499677822
mocha                0.880629775
concentration        1.304697060
spices               1.737683118
textured             0.616720124
toasted              0.660691016
drinking            -1.985303945
red_berry           -0.766247710
flower              -0.578542357
much                -3.235245795
black_currant       -1.129962726
cedar                .          
blueberry            0.596647519
grapes              -0.159173155
comes                0.424401180
zest                 0.827604118
pinot_noir           .          
glass                1.533652066
body                 0.051284032
cranberry            0.498775049
toasty               2.120538213
noir                 .          
quite               -1.667513620
pretty              -0.735874676
medium_bodied        .          
crushed              1.565792237
bitter              -5.422153166
make                -0.143225847
gives                .          
edge                -0.985576583
tangy               -0.250037779
generous             2.978563887
show                -1.482775263
plenty              -0.531782754
lightly             -0.791399466
scents              -0.560373223
complexity           3.762840819
minerality           3.377197717
black_fruit          .          
baked               -0.107438020
alcohol             -1.998133249
bottling             2.625967359
showing              0.243332721
finishes            -1.648959654
refreshing           0.631359591
cinnamon             1.698532588
core                 1.502857885
round               -0.062279669
tastes              -2.565517403
apricot              .          
barrel               0.205321269
solid                .          
tropical            -0.524575527
come                 0.035602066
floral               0.617689558
best                 2.448660710
attractive          -1.987969063
earth                0.912590271
weight               0.075656545
pineapple           -0.410430662
intense              3.145225662
simple              -6.365378428
stone                1.346953054
2018                 6.385695180
little              -2.323852732
high                 0.024676393
wild                 2.117255235
clove                0.231694441
feel                -1.036866343
almost               0.304113057
palate_offers       -1.205206249
grapefruit           0.562208147
honey                1.115784576
melon               -0.349446790
coffee               1.241455034
big                  .          
delivers             0.533933274
color               -1.782457516
ready_drink         -2.420635197
feels               -1.042857521
cola                 0.621848279
yellow               0.843592607
cherries            -0.413735854
lively               1.062402757
vintage              1.757655142
strawberry          -0.257235001
freshness            1.791056415
smoky               -0.030407120
young                0.222779785
time                 1.625255277
herbs                1.328096405
cassis               1.956338344
richness             3.999273458
new                  1.396426020
mouthfeel           -0.870379868
complex              7.109465185
chardonnay          -1.887821232
yet                  3.219624108
easy                -3.720996419
hints               -1.324315977
slightly            -1.805619740
elegant              4.197820555
great                4.436490161
lead                -0.794437069
earthy              -0.351119115
ready                .          
savory               1.156927036
tobacco              0.828546334
cabernet_sauvignon   1.412835583
leather              .          
alongside            .          
delicious            6.801283279
tight                0.284624497
structured           1.815158853
dense                2.966977146
syrah               -1.292245558
along                0.596251823
aging                2.160575344
opens                .          
balance              0.752237680
one                  1.102357083
toast                1.149851174
give                -0.154085746
creamy               0.166064718
clean               -1.278248847
lime                 0.765181714
age                  1.721162927
bit                 -2.024668786
orange               .          
merlot              -3.107485287
hint                -1.242326865
still                1.048730031
licorice             2.527053800
flavor              -2.592792794
note                -1.858490775
vineyard             4.448554341
herbal              -2.058097965
tart                -2.418073026
mineral              2.669846880
also                 .          
tannic              -2.216387171
concentrated         3.362997441
herb                 0.270281631
long                 7.331306388
just                 0.183281606
style               -0.552076014
mouth               -1.002711052
currant              .          
medium              -4.211661145
pinot               -0.438357005
full_bodied          .          
made                 .          
wood                -0.667870049
fine                 2.411718191
smooth               0.976820307
spicy                0.292914909
fruit_flavors        2.464859860
structure            0.881648653
sauvignon           -0.160565494
pear                 0.040900901
years                6.684405269
dried                0.308909914
black_cherry         0.841684732
will                 .          
character           -2.253971384
like                -1.249316358
touch               -0.191518325
balanced             2.443356353
peach               -0.703479217
chocolate            1.878347651
firm                 1.555294607
lemon                .          
raspberry           -0.041280411
fruity              -3.181654990
good                -1.625554884
green               -4.131756413
juicy                0.596944786
pepper              -0.715189996
drink_now           -5.332528669
cabernet            -0.044127005
bright               0.052866259
vanilla             -0.463131683
bodied              -0.165359885
citrus              -0.567169709
shows               -0.791413383
dark                 1.796429232
texture              0.327820678
offers              -1.586578445
light               -3.109577469
crisp               -1.838672690
white               -1.706153376
blackberry           .          
blend               -0.446100895
apple               -1.148219278
well                 1.267056596
fruits              -0.449122869
sweet               -3.454364985
soft                -4.449373864
plum                -0.038842901
full                 1.622045963
nose                -3.359100375
berry               -0.564601796
now                  2.750751859
dry                 -2.403634110
fresh                0.323930199
rich                 5.462277584
oak                 -2.211823019
notes               -2.498731869
spice                0.382815647
red                 -3.428644394
ripe                 0.877450750
black                1.948368207
cherry              -1.883074842
drink               -2.358355240
tannins             -2.677941854
acidity             -2.819004738
finish              -2.689621697
palate              -2.101055766
aromas              -5.479806027
fruit               -4.848278728
flavors            -11.066157669
wine                -7.206241254
#trying different type of prediction method
preds2 = data.frame(id=test$points, predict(fit, dtm_test_tfidf, type = "response", s = 0.05))
preds2
preds3 = data.frame(id = test$points, predict(fit, dtm_test_tfidf, type.measure = "mse", nfolds = 20))
preds3
preds4 = data.frame(id = test$points, predict(fit, dtm_test_tfidf, s = "lambda.min"))
preds4
> mse<- mean((preds2$id - preds2$X1)^2)
> print(mse)
[1] 4.378957
> mse<- mean((preds3$id - preds3$X1)^2)
> print(mse)
[1] 3.45192
> mse<- mean((preds4$id - preds4$X1)^2)
> print(mse)
[1] 3.440155
#preds 4 is the best prediction moethod, using fit model and lambda.min as the S value -"Value(s) of the penalty parameter lambda at which predictions are required. Default is the value s="lambda.1se" stored on the CV object. Alternatively s="lambda.min" can be used. If s is numeric, it is taken as the value(s) of lambda to be used."
 preds5 = data.frame(id=test$points, predict.cv.glmnet(fit, dtm_test_tfidf, s="lambda.min"))
> mse<- mean((preds5$id - preds5$X1)^2)
> print(mse)
[1] 3.440155
#preds 5 and preds4 are similar in accuracy.next move on to see if we could predict the log price as well.

fit_logprice= cv.glmnet(x = dtm_train_tfidf, y = train[['logprice']], type.measure = "mse", nfolds = 20)
coef(fit_logprice, s = "lambda.min")
preds_logprice = data.frame(id=test$logprice, predict.cv.glmnet(fit_logprice, dtm_test_tfidf, s="lambda.min"))
preds_logprice
coef(fit_logprice, s = "lambda.min")
>print(fit_logprice)
$lambda.min
[1] 0.00107758

$lambda.1se
[1] 0.002066702

attr(,"class")
[1] "cv.glmnet"
> mse<- maen((preds_logprice$id - preds_logprice$X1)^2)
Error in maen((preds_logprice$id - preds_logprice$X1)^2) : 
  could not find function "maen"
> print(mse)
[1] 3.440155


#let's try with the price directly to see a different in result+
> fit_price= cv.glmnet(x = dtm_train_tfidf, y = train[['price']], type.measure = "mse", nfolds = 20)
> print(fit_price)

$lambda.min
[1] 0.1066846

$lambda.1se
[1] 1.315258

attr(,"class")
[1] "cv.glmnet"
> preds_price = data.frame(id=test$price,predict.cv.glmnet(fit_price, dtm_test_tfidf, s="lambda.min"))
> > mse<- mean((preds_price$id - preds_price$X1)^2)
> print(mse)
[1] 1792.444
#cannot use price directly.


> dtm2_train <-cbind(train$points, dtm_train_tfidf)
> dtm2_test <-cbind(test$points, dtm_test_tfidf)
> fit_2_points = cv.glmnet(x = dtm2_train, y = train[['points']], type.measure = "mse", nfolds = 20)

> fit_2_points = glmnet(x = dtm2_train, y = train[['points']], type.measure = "mse", nfolds = 20)

> library(glmnet)
Loading required package: Matrix
Loading required package: foreach
Loaded glmnet 2.0-16

> fit_2_points = cv.glmnet(x = dtm2_train, y = train[['points']], type.measure = "mse", nfolds = 20)
> fit2_prediction = data.frame(id = test$points, predict(fit_2_points, dtm2_train, s = "lambda.min"))
> fit2_prediction
> mse <- mean((fit2_prediction$id - fit2_prediction$X1)^2)
> print(mse)
[1] 18.47893
> > fit_2_points$lambda.min
[1] 0.09904023
> fit_2_points$lambda.1se
[1] 0.09904023
> library(broom)
> glance(fit_2_points)
# A tibble: 1 x 2
  lambda.min lambda.1se
       <dbl>      <dbl>
1     0.0990     0.0990
> glance(fit)
# A tibble: 1 x 2
  lambda.min lambda.1se
       <dbl>      <dbl>
1    0.00307    0.00537
#fit is still better given smaller min mse
